{"root":{"data":{"id":"d889mouq7400","created":1741171065224,"text":"Snack组件库"},"children":[{"data":{"id":"d88teiei7880","created":1741226846468,"text":"sie-form","layout":null},"children":[]},{"data":{"id":"d88teoiucog0","created":1741226859791,"text":"sie-table","layout":null},"children":[]},{"data":{"id":"d88tetno2480","created":1741226870966,"text":"简化模板","expandState":"expand","layout":null},"children":[{"data":{"id":"d88tf7cxld40","created":1741226900792,"text":"表格","layout":null},"children":[{"data":{"id":"d88tfhsfsf40","created":1741226923497,"text":"带搜索","layout":null},"children":[]}]},{"data":{"id":"d88tf3g0spc0","created":1741226892272,"text":"弹窗表单","layout":null,"expandState":"expand"},"children":[{"data":{"id":"d88yclq3tdk0","created":1741240802521,"text":"需要配置的点：","expandState":"expand","layout":null},"children":[]},{"data":{"id":"d88ycz11ayw0","created":1741240831480,"text":"示例代码","expandState":"expand","layout":null},"children":[{"data":{"id":"d88tft92kyo0","created":1741226948448,"text":"<template>\n  <tiny-dialog-box v-model:visible=\"visible\" :title=\"dialogTitle\" width=\"55%\" right-slide :close-on-click-modal=\"false\">\n\t<sie-form ref=\"formRef\" v-model=\"formData\" v-bind=\"formOptions\" style=\"padding-top: 20px\"></sie-form>\n\n\t<template #footer>\n\t  <tiny-button type=\"primary\" :loading=\"loading\" @click=\"handleConfirm\">保 存</tiny-button>\n\t  <tiny-button :loading=\"loading\" @click=\"hideDialog\">取 消</tiny-button>\n\t</template>\n  </tiny-dialog-box>\n</template>\n\n<script lang=\"ts\">\nexport default {\n  name: \"DetailDialog\"\n};\n</script>\n\n<script setup lang=\"ts\">\nimport { ref, computed } from \"vue\";\nimport { SieForm } from \"@dme/snack-ui\";\n\nimport api from \"../api/index.js\";\n\nimport { catchErr } from \"@/utils/index.js\";\nimport { $notify } from \"@/utils/tiny-vue.js\";\n\nconst emits = defineEmits([\"save\"]);\n\n// 加载状态\nconst loading = ref(false);\n// 弹窗，显示隐藏\nconst visible = ref(false);\n// 操作类型\nconst operateType = ref(\"add\");\n// 弹窗标题\nconst dialogTitle = computed(() => `${operateType.value == \"edit\" ? \"编辑\" : \"新增\"}`);\n/**\n * 显示弹窗\n * @param operateType 操作类型\n * @param data 传入数据\n */\nconst showDialog = (type = \"add\", data = null) => {\n  visible.value = true;\n  operateType.value = type;\n\n  // 编辑、复制新增时，回显数据\n  if (operateType.value === \"edit\" || operateType.value === \"copyAdd\") {\n\tformData.value = { data\n\t};\n  }\n};\n\n/**\n * 隐藏弹窗\n */\nconst hideDialog = () => {\n  visible.value = false;\n  formRef.value.resetFields();\n};\n\n// 表单实例\nconst formRef = ref();\n// 表单数据\nconst formData = ref({});\n// 表单配置\nconst formOptions = computed(() => ({\n  labelWidth: \"120px\",\n  validateType: \"text\",\n  formItemList: []\n}));\n\nconst handleConfirm = () => {\n  if (loading.value) return;\n\n  // 表单校验\n  formRef.value.validate(async isValidate => {\n\tif (!isValidate) {\n\t  return;\n\t}\n\n\tloading.value = true;\n\ttry {\n\t  // 带有id，调用更新接口，否则调用新增接口\n\t  const _api = formData.value?.id ? api.mainTable.update : api.mainTable.create;\n\n\t  const res = await _api(formData.value);\n\t  if (res.code === 0) {\n\t    $notify(\"保存成功\");\n\t    emits(\"save\");\n\n\t    hideDialog();\n\t  }\n\t} catch (err) {\n\t  catchErr(err);\n\t}\n\tloading.value = false;\n  });\n};\n\ndefineExpose({ showDialog, hideDialog });\n</script>\n\n<style lang=\"less\"></style>template\ntiny-dialog-boxv-modelvisibletitlewidth\"55%\"right-slideclose-on-click-modalfalse\nsie-formref\"formRef\"v-modelv-bindstylepadding-top20pxsie-form\n\ntemplatefooter\ntiny-buttontype\"primary\"loadingclickhandleConfirmtiny-button\ntiny-buttonloadingclickhideDialogtiny-button\ntemplate\ntiny-dialog-box\ntemplate\n\nscriptlang\"ts\"\nexportdefault\n\"DetailDialog\"\n\nscript\n\nscriptsetuplang\"ts\"\nimportfrom\"vue\"\nimportfrom\"@dme/snack-ui\"\n\nimportfrom\"../api/index.js\"\n\nimportfrom\"@/utils/index.js\"\nimportfrom\"@/utils/tiny-vue.js\"\n\nconstemits=defineEmits\"save\"\n\n// 加载状态\nconst=reffalse\n// 弹窗，显示隐藏\nconst=reffalse\n// 操作类型\nconst=ref\"add\"\n// 弹窗标题\nconst=computed=>`${==\"edit\"?\"编辑\":\"新增\"}`\n/**\n * 显示弹窗\n * @param  操作类型\n * @param  传入数据\n */\nconstshowDialog=type=\"add\"data=null=>\n=true\n=type\n\n// 编辑、复制新增时，回显数据\nif===\"edit\"||===\"copyAdd\"\n=\n...data\n\n\n\n\n/**\n * 隐藏弹窗\n */\nconsthideDialog==>\n=false\nresetFields\n\n\n// 表单实例\nconst=ref\n// 表单数据\nconst=ref\n// 表单配置\nconst=computed=>\n\"120px\"\n\"text\"\n\n\n\nconsthandleConfirm==>\nifreturn\n\n// 表单校验\nvalidateasyncisValidate=>\nif!isValidate\nreturn\n\n\n=true\ntry\n// 带有id，调用更新接口，否则调用新增接口\nconst_api=?update:create\n\nconst=await_api\nif===0\n$notify\"保存成功\"\nemits\"save\"\n\nhideDialog\n\ncatch\ncatchErr\n\n=false\n\n\n\ndefineExposeshowDialoghideDialog\nscript\n\nstylelang\"less\"style","layout":null},"children":[]}]}]}]}]},"template":"right","theme":"fresh-blue","version":"1.4.43"}